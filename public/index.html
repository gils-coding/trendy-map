<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íŠ¸ë Œë””ë§µ â€” ìœ í–‰ ë§›ì§‘ ì§€ë„</title>

  <!-- ì¹´ì¹´ì˜¤ ì§€ë„ API (services ëª¨ë“ˆ ì¶”ê°€: ì§€ì—­ ê²€ìƒ‰ìš©) -->
  <script type="text/javascript"
    src="//dapi.kakao.com/v2/maps/sdk.js?appkey=622851c76acbe34dcda4cce3cc03c38b&libraries=services">
    </script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg: #0f0e0c;
      --surface: #1a1916;
      --card: #222118;
      --accent: #f5c842;
      --accent2: #e8854a;
      --text: #f0ede6;
      --muted: #7a7668;
      --border: #2e2c26;
      --tag-bg: #2a2820;
      --open: #4ade80;
      --closed: #f87171;
    }

    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* â”€â”€ í—¤ë” â”€â”€ */
    header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      z-index: 100;
      flex-shrink: 0;
      flex-wrap: wrap;
      gap: 8px;
    }

    .logo {
      font-family: 'Black Han Sans', sans-serif;
      font-size: 20px;
      color: var(--accent);
      white-space: nowrap;
    }

    .logo span {
      color: var(--accent2);
    }

    .tabs {
      display: flex;
      gap: 6px;
      overflow-x: auto;
      scrollbar-width: none;
      flex: 1;
      min-width: 0;
    }

    .tabs::-webkit-scrollbar {
      display: none;
    }

    .tab {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
      border: 1.5px solid var(--border);
      background: var(--tag-bg);
      color: var(--muted);
      transition: all 0.2s;
      flex-shrink: 0;
    }

    .tab:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .tab.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #000;
      font-weight: 700;
    }

    /* â”€â”€ ì§€ì—­ ê²€ìƒ‰ë°” â”€â”€ */
    .region-bar {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }

    .region-search {
      display: flex;
      gap: 6px;
      flex: 1;
    }

    .region-input {
      flex: 1;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 7px 12px;
      color: var(--text);
      font-size: 13px;
      font-family: inherit;
      outline: none;
    }

    .region-input:focus {
      border-color: var(--accent);
    }

    .region-input::placeholder {
      color: var(--muted);
    }

    .region-btn {
      padding: 7px 14px;
      background: var(--accent);
      color: #000;
      border: none;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      white-space: nowrap;
      font-family: inherit;
    }

    .region-btn:hover {
      background: #e6b800;
    }

    /* ì‹œë„ ë“œë¡­ë‹¤ìš´ */
    .sido-select {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 7px 10px;
      color: var(--text);
      font-size: 12px;
      font-family: inherit;
      outline: none;
      cursor: pointer;
      min-width: 90px;
    }

    .sigungu-select {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 7px 10px;
      color: var(--text);
      font-size: 12px;
      font-family: inherit;
      outline: none;
      cursor: pointer;
      min-width: 100px;
    }

    /* â”€â”€ ë©”ì¸ ë ˆì´ì•„ì›ƒ â”€â”€ */
    .main {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* â”€â”€ ì‚¬ì´ë“œë°” â”€â”€ */
    .sidebar {
      width: 320px;
      flex-shrink: 0;
      background: var(--surface);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .sidebar-header {
      padding: 14px 18px 10px;
      border-bottom: 1px solid var(--border);
    }

    .sidebar-header h2 {
      font-family: 'Black Han Sans', sans-serif;
      font-size: 16px;
    }

    .sidebar-header p {
      font-size: 11px;
      color: var(--muted);
      margin-top: 3px;
    }

    .store-list {
      flex: 1;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: var(--border) transparent;
    }

    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 160px;
      gap: 10px;
      color: var(--muted);
      font-size: 12px;
    }

    .spinner {
      width: 28px;
      height: 28px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .store-item {
      padding: 13px 18px;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: background 0.15s;
    }

    .store-item:hover,
    .store-item.selected {
      background: var(--card);
    }

    .store-item.selected {
      border-left: 3px solid var(--accent);
      padding-left: 15px;
    }

    .store-name {
      font-weight: 700;
      font-size: 13px;
      margin-bottom: 3px;
    }

    .store-addr {
      font-size: 11px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .store-meta {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
      align-items: center;
    }

    .badge {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 8px;
      font-weight: 500;
      background: var(--tag-bg);
      color: var(--muted);
    }

    .badge.open-badge {
      background: #1a3320;
      color: var(--open);
    }

    .badge.closed-badge {
      background: #2d1a1a;
      color: var(--closed);
    }

    /* â”€â”€ ì§€ë„ â”€â”€ */
    .map-area {
      flex: 1;
      position: relative;
    }

    #map {
      width: 100%;
      height: 100%;
    }

    /* ì§€ë„ ìœ„ ê²€ìƒ‰ ì¤‘ ì˜¤ë²„ë ˆì´ */
    .map-loading {
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 8px 16px;
      font-size: 12px;
      color: var(--muted);
      z-index: 50;
      display: flex;
      align-items: center;
      gap: 8px;
      opacity: 0;
      transition: opacity 0.2s;
      pointer-events: none;
    }

    .map-loading.show {
      opacity: 1;
    }

    .map-loading .mini-spinner {
      width: 14px;
      height: 14px;
      border: 2px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    /* â”€â”€ ìƒì„¸ íŒ¨ë„ â”€â”€ */
    .detail-panel {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 300px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 8px 40px rgba(0, 0, 0, 0.6);
      transform: translateY(16px);
      opacity: 0;
      pointer-events: none;
      transition: all 0.25s ease;
      z-index: 50;
      max-height: calc(100vh - 160px);
      overflow-y: auto;
    }

    .detail-panel.show {
      transform: translateY(0);
      opacity: 1;
      pointer-events: all;
    }

    .detail-top {
      padding: 18px 18px 14px;
      border-bottom: 1px solid var(--border);
    }

    .detail-name {
      font-family: 'Black Han Sans', sans-serif;
      font-size: 17px;
      margin-bottom: 6px;
      padding-right: 26px;
      line-height: 1.3;
    }

    .open-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .open-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
    }

    .open-dot.on {
      background: var(--open);
      box-shadow: 0 0 5px var(--open);
    }

    .open-dot.off {
      background: var(--closed);
    }

    .open-dot.unk {
      background: var(--muted);
    }

    .info-list {
      display: flex;
      flex-direction: column;
      gap: 9px;
    }

    .info-row {
      display: flex;
      align-items: flex-start;
      gap: 9px;
      font-size: 12px;
    }

    .info-icon {
      flex-shrink: 0;
      width: 16px;
      text-align: center;
      margin-top: 1px;
    }

    .info-val {
      color: var(--text);
      line-height: 1.6;
    }

    .info-val.accent {
      color: var(--accent);
    }

    .info-val.muted {
      color: var(--muted);
      font-size: 11px;
      font-style: italic;
    }

    .hours-text {
      white-space: pre-line;
    }

    .detail-bottom {
      padding: 12px 14px;
      display: flex;
      gap: 7px;
    }

    .btn {
      flex: 1;
      display: block;
      padding: 9px 0;
      border-radius: 7px;
      text-align: center;
      text-decoration: none;
      font-weight: 700;
      font-size: 12px;
      transition: opacity 0.15s;
    }

    .btn:hover {
      opacity: 0.85;
    }

    .btn-naver {
      background: #03c75a;
      color: #fff;
    }

    .btn-kakao {
      background: var(--accent);
      color: #000;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--muted);
      font-size: 13px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    .error-msg {
      padding: 20px 16px;
      text-align: center;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.8;
    }

    .error-msg strong {
      color: var(--accent2);
      display: block;
      margin-bottom: 6px;
      font-size: 13px;
    }

    .error-msg code {
      background: var(--tag-bg);
      padding: 1px 5px;
      border-radius: 3px;
      font-size: 11px;
      color: var(--accent);
    }
  </style>
</head>

<body>

  <!-- í—¤ë”: ë¡œê³  + ì¹´í…Œê³ ë¦¬ íƒ­ -->
  <header>
    <div class="logo">íŠ¸ë Œë””<span>ë§µ</span></div>
    <div class="tabs">
      <div class="tab active" data-query="ë‘ë°”ì´ ì«€ë“ì¿ í‚¤" data-emoji="ğŸª" onclick="switchCategory(this)">ğŸª ë‘ë°”ì´ ì«€ë“ì¿ í‚¤</div>
      <div class="tab" data-query="ì†Œê¸ˆë¹µ" data-emoji="ğŸ¥" onclick="switchCategory(this)">ğŸ¥ ì†Œê¸ˆë¹µ</div>
      <div class="tab" data-query="íƒ•í›„ë£¨" data-emoji="ğŸ¡" onclick="switchCategory(this)">ğŸ¡ íƒ•í›„ë£¨</div>
      <div class="tab" data-query="í¬ë¡œí”Œ" data-emoji="ğŸ§‡" onclick="switchCategory(this)">ğŸ§‡ í¬ë¡œí”Œ</div>
      <div class="tab" data-query="ë§ˆë¼íƒ•" data-emoji="ğŸŒ¶ï¸" onclick="switchCategory(this)">ğŸŒ¶ï¸ ë§ˆë¼íƒ•</div>
    </div>
    <a href="https://forms.gle/ecy5DprNYSAgPesc7" target="_blank" style="
      padding: 6px 12px; background: var(--accent2); color: #fff;
      border-radius: 20px; font-size: 12px; font-weight: 700;
      text-decoration: none; white-space: nowrap; flex-shrink: 0;
    ">âœ¨ ìƒí’ˆ ì œì•ˆ</a>
  </header>

  <!-- ì§€ì—­ ì„ íƒ ë°” -->
  <div class="region-bar">
    <!-- ì‹œë„ ì„ íƒ -->
    <select class="sido-select" id="sidoSelect" onchange="onSidoChange()">
      <option value="">ì‹œ/ë„ ì„ íƒ</option>
      <option value="ì„œìš¸">ì„œìš¸</option>
      <option value="ê²½ê¸°">ê²½ê¸°</option>
      <option value="ì¸ì²œ">ì¸ì²œ</option>
      <option value="ë¶€ì‚°">ë¶€ì‚°</option>
      <option value="ëŒ€êµ¬">ëŒ€êµ¬</option>
      <option value="ëŒ€ì „">ëŒ€ì „</option>
      <option value="ê´‘ì£¼">ê´‘ì£¼</option>
      <option value="ìš¸ì‚°">ìš¸ì‚°</option>
      <option value="ì„¸ì¢…">ì„¸ì¢…</option>
      <option value="ê°•ì›">ê°•ì›</option>
      <option value="ì¶©ë¶">ì¶©ë¶</option>
      <option value="ì¶©ë‚¨">ì¶©ë‚¨</option>
      <option value="ì „ë¶">ì „ë¶</option>
      <option value="ì „ë‚¨">ì „ë‚¨</option>
      <option value="ê²½ë¶">ê²½ë¶</option>
      <option value="ê²½ë‚¨">ê²½ë‚¨</option>
      <option value="ì œì£¼">ì œì£¼</option>
    </select>

    <!-- ì‹œêµ°êµ¬ ì„ íƒ (ì‹œë„ ì„ íƒ í›„ í™œì„±í™”) -->
    <select class="sigungu-select" id="sigunguSelect" onchange="onSigunguChange()" disabled>
      <option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>
    </select>

    <!-- ì§ì ‘ ì…ë ¥ ê²€ìƒ‰ -->
    <div class="region-search">
      <input class="region-input" id="regionInput" type="text" placeholder="ì§€ì—­ ì§ì ‘ ê²€ìƒ‰ (ì˜ˆ: ë§ˆí¬êµ¬)"
        onkeydown="if(event.key==='Enter') searchRegion()" />
      <button class="region-btn" onclick="searchRegion()">ì´ë™</button>
    </div>
  </div>

  <!-- ë©”ì¸ -->
  <div class="main">
    <div class="sidebar">
      <div class="sidebar-header">
        <h2 id="sidebar-title">ğŸª ë‘ë°”ì´ ì«€ë“ì¿ í‚¤</h2>
        <p id="sidebar-count">ì§€ë„ë¥¼ ì›€ì§ì´ë©´ í•´ë‹¹ ì§€ì—­ ë§¤ì¥ì´ í‘œì‹œë©ë‹ˆë‹¤</p>
      </div>
      <div class="store-list" id="storeList">
        <div class="loading">
          <div class="spinner"></div>ë§¤ì¥ ê²€ìƒ‰ ì¤‘...
        </div>
      </div>
    </div>

    <div class="map-area">
      <div id="map"></div>

      <!-- ì§€ë„ ìœ„ ë¡œë”© í‘œì‹œ -->
      <div class="map-loading" id="mapLoading">
        <div class="mini-spinner"></div>
        <span>ì´ ì§€ì—­ ë§¤ì¥ ê²€ìƒ‰ ì¤‘...</span>
      </div>

      <!-- ìƒì„¸ íŒ¨ë„ -->
      <div class="detail-panel" id="detailPanel">
        <button class="close-btn" onclick="closeDetail()">âœ•</button>
        <div class="detail-top">
          <div class="detail-name" id="detailName"></div>
          <div class="open-status" id="detailOpenStatus"></div>
          <div class="info-list">
            <div class="info-row">
              <span class="info-icon">ğŸ“</span>
              <span class="info-val" id="detailAddr"></span>
            </div>
            <div class="info-row" id="detailPhoneRow">
              <span class="info-icon">ğŸ“</span>
              <span class="info-val accent" id="detailPhone"></span>
            </div>
            <div class="info-row" id="detailHoursRow">
              <span class="info-icon">ğŸ•</span>
              <span class="info-val hours-text" id="detailHours"></span>
            </div>
          </div>
        </div>
        <div class="detail-bottom">
          <a class="btn btn-naver" id="btnNaver" href="#" target="_blank">ë„¤ì´ë²„ì§€ë„</a>
          <a class="btn btn-kakao" id="btnKakao" href="#" target="_blank">ì¹´ì¹´ì˜¤ë§µ</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // =====================================================
    // ì‹œêµ°êµ¬ ë°ì´í„°
    // =====================================================
    const SIGUNGU_DATA = {
      'ì„œìš¸': ['ê°•ë‚¨êµ¬', 'ê°•ë™êµ¬', 'ê°•ë¶êµ¬', 'ê°•ì„œêµ¬', 'ê´€ì•…êµ¬', 'ê´‘ì§„êµ¬', 'êµ¬ë¡œêµ¬', 'ê¸ˆì²œêµ¬', 'ë…¸ì›êµ¬', 'ë„ë´‰êµ¬', 'ë™ëŒ€ë¬¸êµ¬', 'ë™ì‘êµ¬', 'ë§ˆí¬êµ¬', 'ì„œëŒ€ë¬¸êµ¬', 'ì„œì´ˆêµ¬', 'ì„±ë™êµ¬', 'ì„±ë¶êµ¬', 'ì†¡íŒŒêµ¬', 'ì–‘ì²œêµ¬', 'ì˜ë“±í¬êµ¬', 'ìš©ì‚°êµ¬', 'ì€í‰êµ¬', 'ì¢…ë¡œêµ¬', 'ì¤‘êµ¬', 'ì¤‘ë‘êµ¬'],
      'ê²½ê¸°': ['ìˆ˜ì›ì‹œ', 'ì„±ë‚¨ì‹œ', 'ì˜ì •ë¶€ì‹œ', 'ì•ˆì–‘ì‹œ', 'ë¶€ì²œì‹œ', 'ê´‘ëª…ì‹œ', 'í‰íƒì‹œ', 'ë™ë‘ì²œì‹œ', 'ì•ˆì‚°ì‹œ', 'ê³ ì–‘ì‹œ', 'ê³¼ì²œì‹œ', 'êµ¬ë¦¬ì‹œ', 'ë‚¨ì–‘ì£¼ì‹œ', 'ì˜¤ì‚°ì‹œ', 'ì‹œí¥ì‹œ', 'êµ°í¬ì‹œ', 'ì˜ì™•ì‹œ', 'í•˜ë‚¨ì‹œ', 'ìš©ì¸ì‹œ', 'íŒŒì£¼ì‹œ', 'ì´ì²œì‹œ', 'ì•ˆì„±ì‹œ', 'ê¹€í¬ì‹œ', 'í™”ì„±ì‹œ', 'ê´‘ì£¼ì‹œ', 'ì–‘ì£¼ì‹œ', 'í¬ì²œì‹œ', 'ì—¬ì£¼ì‹œ', 'ì—°ì²œêµ°', 'ê°€í‰êµ°', 'ì–‘í‰êµ°'],
      'ì¸ì²œ': ['ì¤‘êµ¬', 'ë™êµ¬', 'ë¯¸ì¶”í™€êµ¬', 'ì—°ìˆ˜êµ¬', 'ë‚¨ë™êµ¬', 'ë¶€í‰êµ¬', 'ê³„ì–‘êµ¬', 'ì„œêµ¬', 'ê°•í™”êµ°', 'ì˜¹ì§„êµ°'],
      'ë¶€ì‚°': ['ì¤‘êµ¬', 'ì„œêµ¬', 'ë™êµ¬', 'ì˜ë„êµ¬', 'ë¶€ì‚°ì§„êµ¬', 'ë™ë˜êµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'í•´ìš´ëŒ€êµ¬', 'ì‚¬í•˜êµ¬', 'ê¸ˆì •êµ¬', 'ê°•ì„œêµ¬', 'ì—°ì œêµ¬', 'ìˆ˜ì˜êµ¬', 'ì‚¬ìƒêµ¬', 'ê¸°ì¥êµ°'],
      'ëŒ€êµ¬': ['ì¤‘êµ¬', 'ë™êµ¬', 'ì„œêµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'ìˆ˜ì„±êµ¬', 'ë‹¬ì„œêµ¬', 'ë‹¬ì„±êµ°'],
      'ëŒ€ì „': ['ë™êµ¬', 'ì¤‘êµ¬', 'ì„œêµ¬', 'ìœ ì„±êµ¬', 'ëŒ€ë•êµ¬'],
      'ê´‘ì£¼': ['ë™êµ¬', 'ì„œêµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'ê´‘ì‚°êµ¬'],
      'ìš¸ì‚°': ['ì¤‘êµ¬', 'ë‚¨êµ¬', 'ë™êµ¬', 'ë¶êµ¬', 'ìš¸ì£¼êµ°'],
      'ì„¸ì¢…': ['ì„¸ì¢…ì‹œ'],
      'ê°•ì›': ['ì¶˜ì²œì‹œ', 'ì›ì£¼ì‹œ', 'ê°•ë¦‰ì‹œ', 'ë™í•´ì‹œ', 'íƒœë°±ì‹œ', 'ì†ì´ˆì‹œ', 'ì‚¼ì²™ì‹œ', 'í™ì²œêµ°', 'íš¡ì„±êµ°', 'ì˜ì›”êµ°', 'í‰ì°½êµ°', 'ì •ì„ êµ°', 'ì² ì›êµ°', 'í™”ì²œêµ°', 'ì–‘êµ¬êµ°', 'ì¸ì œêµ°', 'ê³ ì„±êµ°', 'ì–‘ì–‘êµ°'],
      'ì¶©ë¶': ['ì²­ì£¼ì‹œ', 'ì¶©ì£¼ì‹œ', 'ì œì²œì‹œ', 'ë³´ì€êµ°', 'ì˜¥ì²œêµ°', 'ì˜ë™êµ°', 'ì¦í‰êµ°', 'ì§„ì²œêµ°', 'ê´´ì‚°êµ°', 'ìŒì„±êµ°', 'ë‹¨ì–‘êµ°'],
      'ì¶©ë‚¨': ['ì²œì•ˆì‹œ', 'ê³µì£¼ì‹œ', 'ë³´ë ¹ì‹œ', 'ì•„ì‚°ì‹œ', 'ì„œì‚°ì‹œ', 'ë…¼ì‚°ì‹œ', 'ê³„ë£¡ì‹œ', 'ë‹¹ì§„ì‹œ', 'ê¸ˆì‚°êµ°', 'ë¶€ì—¬êµ°', 'ì„œì²œêµ°', 'ì²­ì–‘êµ°', 'í™ì„±êµ°', 'ì˜ˆì‚°êµ°', 'íƒœì•ˆêµ°'],
      'ì „ë¶': ['ì „ì£¼ì‹œ', 'êµ°ì‚°ì‹œ', 'ìµì‚°ì‹œ', 'ì •ìì‹œ', 'ë‚¨ì›ì‹œ', 'ê¹€ì œì‹œ', 'ì™„ì£¼êµ°', 'ì§„ì•ˆêµ°', 'ë¬´ì£¼êµ°', 'ì¥ìˆ˜êµ°', 'ì„ì‹¤êµ°', 'ìˆœì°½êµ°', 'ê³ ì°½êµ°', 'ë¶€ì•ˆêµ°'],
      'ì „ë‚¨': ['ëª©í¬ì‹œ', 'ì—¬ìˆ˜ì‹œ', 'ìˆœì²œì‹œ', 'ë‚˜ì£¼ì‹œ', 'ê´‘ì–‘ì‹œ', 'ë‹´ì–‘êµ°', 'ê³¡ì„±êµ°', 'êµ¬ë¡€êµ°', 'ê³ í¥êµ°', 'ë³´ì„±êµ°', 'í™”ìˆœêµ°', 'ì¥í¥êµ°', 'ê°•ì§„êµ°', 'í•´ë‚¨êµ°', 'ì˜ì•”êµ°', 'ë¬´ì•ˆêµ°', 'í•¨í‰êµ°', 'ì˜ê´‘êµ°', 'ì¥ì„±êµ°', 'ì™„ë„êµ°', 'ì§„ë„êµ°', 'ì‹ ì•ˆêµ°'],
      'ê²½ë¶': ['í¬í•­ì‹œ', 'ê²½ì£¼ì‹œ', 'ê¹€ì²œì‹œ', 'ì•ˆë™ì‹œ', 'êµ¬ë¯¸ì‹œ', 'ì˜ì£¼ì‹œ', 'ì˜ì²œì‹œ', 'ìƒì£¼ì‹œ', 'ë¬¸ê²½ì‹œ', 'ê²½ì‚°ì‹œ', 'ì˜ì„±êµ°', 'ì²­ì†¡êµ°', 'ì˜ì–‘êµ°', 'ì˜ë•êµ°', 'ì²­ë„êµ°', 'ê³ ë ¹êµ°', 'ì„±ì£¼êµ°', 'ì¹ ê³¡êµ°', 'ì˜ˆì²œêµ°', 'ë´‰í™”êµ°', 'ìš¸ì§„êµ°', 'ìš¸ë¦‰êµ°'],
      'ê²½ë‚¨': ['ì°½ì›ì‹œ', 'ì§„ì£¼ì‹œ', 'í†µì˜ì‹œ', 'ì‚¬ì²œì‹œ', 'ê¹€í•´ì‹œ', 'ë°€ì–‘ì‹œ', 'ê±°ì œì‹œ', 'ì–‘ì‚°ì‹œ', 'ì˜ë ¹êµ°', 'í•¨ì•ˆêµ°', 'ì°½ë…•êµ°', 'ê³ ì„±êµ°', 'ë‚¨í•´êµ°', 'í•˜ë™êµ°', 'ì‚°ì²­êµ°', 'í•¨ì–‘êµ°', 'ê±°ì°½êµ°', 'í•©ì²œêµ°'],
      'ì œì£¼': ['ì œì£¼ì‹œ', 'ì„œê·€í¬ì‹œ'],
    };

    // =====================================================
    // ì§€ë„ & ìƒíƒœ ë³€ìˆ˜
    // =====================================================
    const COLORS = {
      'ë‘ë°”ì´ ì«€ë“ì¿ í‚¤': '#CCFFCC',
      'ì†Œê¸ˆë¹µ': '#FEFFDE',
      'íƒ•í›„ë£¨': '#FFE8E8',
      'í¬ë¡œí”Œ': '#FEFFDE',
      'ë§ˆë¼íƒ•': '#FFE8E8',
    };

    let kakaoMap = null;
    let markers = [];
    let currentQuery = 'ë‘ë°”ì´ ì«€ë“ì¿ í‚¤';
    let currentEmoji = 'ğŸª';
    let searchTimer = null;  // ë””ë°”ìš´ìŠ¤ìš©
    let isSearching = false;

    // =====================================================
    // ì§€ë„ ì´ˆê¸°í™”
    // =====================================================
    function initMap() {
      kakaoMap = new kakao.maps.Map(document.getElementById('map'), {
        center: new kakao.maps.LatLng(37.5665, 126.9784), // ì„œìš¸ ì‹œì²­
        level: 7,
      });

      // ì§€ë„ ì´ë™/ì¤Œ ì™„ë£Œ ì‹œ ìë™ ê²€ìƒ‰ (ë””ë°”ìš´ìŠ¤ 500ms)
      kakao.maps.event.addListener(kakaoMap, 'dragend', () => scheduleSearch());
      kakao.maps.event.addListener(kakaoMap, 'zoom_changed', () => scheduleSearch());

      // ì´ˆê¸° ë¡œë“œ
      loadStores();
    }

    // =====================================================
    // ë””ë°”ìš´ìŠ¤: ì§€ë„ ì´ë™ì´ ëë‚œ ë’¤ 500ms í›„ ê²€ìƒ‰
    // =====================================================
    function scheduleSearch() {
      clearTimeout(searchTimer);
      searchTimer = setTimeout(() => loadStores(), 500);
    }

    // =====================================================
    // ë§¤ì¥ ê²€ìƒ‰
    // =====================================================
    async function loadStores() {
      if (isSearching) return;
      isSearching = true;

      const center = kakaoMap.getCenter();
      const lat = center.getLat();
      const lng = center.getLng();

      // ì¤Œ ë ˆë²¨ì— ë”°ë¼ ê²€ìƒ‰ ë°˜ê²½ ì¡°ì •
      const level = kakaoMap.getLevel();
      const radius = Math.min(level * 700, 20000); // ìµœëŒ€ 20km

      showMapLoading(true);
      closeDetail();
      clearMarkers();

      document.getElementById('storeList').innerHTML =
        '<div class="loading"><div class="spinner"></div>ë§¤ì¥ ê²€ìƒ‰ ì¤‘...</div>';
      document.getElementById('sidebar-count').textContent = 'ê²€ìƒ‰ ì¤‘...';

      try {
        const res = await fetch(`/api/stores?query=${encodeURIComponent(currentQuery)}&lat=${lat}&lng=${lng}&radius=${radius}`);
        const data = await res.json();
        if (data.error) throw new Error(data.error);

        window._stores = data.stores;
        renderStoreList(data.stores);
        renderMarkers(data.stores);

      } catch (err) {
        document.getElementById('storeList').innerHTML = `
      <div class="error-msg">
        <strong>âš ï¸ ê²€ìƒ‰ ì‹¤íŒ¨</strong>
        <code>server.js</code>ì˜ API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.<br>
        ì˜¤ë¥˜: ${err.message}
      </div>`;
        document.getElementById('sidebar-count').textContent = 'ì˜¤ë¥˜ ë°œìƒ';
      } finally {
        showMapLoading(false);
        isSearching = false;
      }
    }

    function showMapLoading(show) {
      document.getElementById('mapLoading').classList.toggle('show', show);
    }

    // =====================================================
    // ì‚¬ì´ë“œë°” ë Œë”ë§
    // =====================================================
    function renderStoreList(stores) {
      const center = kakaoMap.getCenter();
      const areaStr = `ìœ„ë„ ${center.getLat().toFixed(3)} ê·¼ì²˜`;

      document.getElementById('sidebar-title').textContent = `${currentEmoji} ${currentQuery}`;
      document.getElementById('sidebar-count').innerHTML =
        stores.length > 0
          ? `ê²€ìƒ‰ ê²°ê³¼ <strong>${stores.length}ê³³</strong>`
          : 'ì´ ì§€ì—­ì— ë§¤ì¥ì´ ì—†ìŠµë‹ˆë‹¤';

      if (stores.length === 0) {
        document.getElementById('storeList').innerHTML =
          '<div class="error-msg">ì´ ì§€ì—­ì—ì„œ ê²€ìƒ‰ëœ ë§¤ì¥ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì§€ë„ë¥¼ ì´ë™í•˜ê±°ë‚˜ ë‹¤ë¥¸ ì§€ì—­ì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”.</div>';
        return;
      }

      document.getElementById('storeList').innerHTML = stores.map((s, i) => {
        let openBadge = '';
        if (s.isOpen === true) openBadge = '<span class="badge open-badge">â— ì˜ì—…ì¤‘</span>';
        else if (s.isOpen === false) openBadge = '<span class="badge closed-badge">â— ì˜ì—…ì¢…ë£Œ</span>';

        return `
      <div class="store-item" id="store-${i}" onclick="selectStore(${i})">
        <div class="store-name">${s.name}</div>
        <div class="store-addr">ğŸ“ ${s.addr}</div>
        <div class="store-meta">
          ${openBadge}
          ${s.category ? `<span class="badge">${s.category.split('>').pop()}</span>` : ''}
          ${s.phone ? `<span class="badge">ğŸ“ ${s.phone}</span>` : ''}
        </div>
      </div>`;
      }).join('');
    }

    // =====================================================
    // ë§ˆì»¤ ë Œë”ë§
    // =====================================================
    function clearMarkers() {
      markers.forEach(m => m.setMap(null));
      markers = [];
    }

    function renderMarkers(stores) {
      const color = COLORS[currentQuery] || '#f5c842';

      stores.forEach((store, i) => {
        if (!store.lat || !store.lng) return;

        const overlay = new kakao.maps.CustomOverlay({
          position: new kakao.maps.LatLng(store.lat, store.lng),
          yAnchor: 1,
          content: `
        <div onclick="selectStore(${i})" style="
          background:${color}; width:34px; height:34px;
          border-radius:50% 50% 50% 0; transform:rotate(-45deg);
          display:flex; align-items:center; justify-content:center;
          box-shadow:0 3px 10px rgba(0,0,0,0.35); cursor:pointer;
          border:2px solid rgba(255,255,255,0.4);
        "><span style="transform:rotate(45deg);font-size:15px">${currentEmoji}</span></div>`,
        });
        overlay.setMap(kakaoMap);
        markers.push(overlay);
      });
    }

    // =====================================================
    // ë§¤ì¥ ì„ íƒ â†’ ìƒì„¸ íŒ¨ë„
    // =====================================================
    function selectStore(index) {
      const store = window._stores?.[index];
      if (!store) return;

      document.querySelectorAll('.store-item').forEach(el => el.classList.remove('selected'));
      const item = document.getElementById(`store-${index}`);
      if (item) { item.classList.add('selected'); item.scrollIntoView({ behavior: 'smooth', block: 'nearest' }); }

      if (store.lat && store.lng) {
        kakaoMap.setCenter(new kakao.maps.LatLng(store.lat, store.lng));
        kakaoMap.setLevel(3);
      }

      // ì˜ì—… ìƒíƒœ
      const statusEl = document.getElementById('detailOpenStatus');
      if (store.isOpen === true) {
        statusEl.innerHTML = '<span class="open-dot on"></span><span style="color:#4ade80">ì˜ì—…ì¤‘</span>';
      } else if (store.isOpen === false) {
        statusEl.innerHTML = '<span class="open-dot off"></span><span style="color:#f87171">ì˜ì—…ì¢…ë£Œ</span>';
      } else {
        statusEl.innerHTML = '<span class="open-dot unk"></span><span style="color:#7a7668">ì˜ì—…ì‹œê°„ ë¯¸í™•ì¸</span>';
      }

      document.getElementById('detailName').textContent = store.name;
      document.getElementById('detailAddr').textContent = store.addr || 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ';
      const hoursRow = document.getElementById('detailHoursRow');
      if (store.hours) {
        document.getElementById('detailHours').textContent = store.hours;
        hoursRow.style.display = 'flex';
      } else {
        hoursRow.style.display = 'none';
      }

      const phoneRow = document.getElementById('detailPhoneRow');
      if (store.phone) {
        document.getElementById('detailPhone').textContent = store.phone;
        phoneRow.style.display = 'flex';
      } else {
        phoneRow.style.display = 'none';
      }

      document.getElementById('btnNaver').href =
        `https://map.naver.com/v5/search/${encodeURIComponent(store.name + ' ' + store.addr)}`;
      document.getElementById('btnKakao').href =
        store.kakaoUrl || `https://map.kakao.com/link/search/${encodeURIComponent(store.name)}`;

      document.getElementById('detailPanel').classList.add('show');
    }

    function closeDetail() {
      document.getElementById('detailPanel').classList.remove('show');
      document.querySelectorAll('.store-item').forEach(el => el.classList.remove('selected'));
    }

    // =====================================================
    // ì¹´í…Œê³ ë¦¬ ì „í™˜
    // =====================================================
    function switchCategory(tabEl) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      tabEl.classList.add('active');
      currentQuery = tabEl.dataset.query;
      currentEmoji = tabEl.dataset.emoji;
      loadStores();
    }

    // =====================================================
    // ì§€ì—­ ì„ íƒ: ì‹œë„ ì„ íƒ â†’ ì‹œêµ°êµ¬ ëª©ë¡ ì±„ìš°ê¸°
    // =====================================================
    function onSidoChange() {
      const sido = document.getElementById('sidoSelect').value;
      const sigungu = document.getElementById('sigunguSelect');
      sigungu.innerHTML = '<option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>';

      if (!sido) { sigungu.disabled = true; return; }

      const list = SIGUNGU_DATA[sido] || [];
      list.forEach(gu => {
        const opt = document.createElement('option');
        opt.value = `${sido} ${gu}`;
        opt.textContent = gu;
        sigungu.appendChild(opt);
      });
      sigungu.disabled = false;
    }

    // =====================================================
    // ì‹œêµ°êµ¬ ì„ íƒ â†’ í•´ë‹¹ ì§€ì—­ìœ¼ë¡œ ì§€ë„ ì´ë™
    // =====================================================
    async function onSigunguChange() {
      const val = document.getElementById('sigunguSelect').value;
      if (!val) return;
      await moveToRegion(val);
    }

    // =====================================================
    // ì§ì ‘ ì…ë ¥ ê²€ìƒ‰
    // =====================================================
    async function searchRegion() {
      const val = document.getElementById('regionInput').value.trim();
      if (!val) return;
      await moveToRegion(val);
    }

    // =====================================================
    // ì§€ì—­ëª… â†’ ì¢Œí‘œ ë³€í™˜ í›„ ì§€ë„ ì´ë™
    // =====================================================
    async function moveToRegion(regionName) {
      try {
        const res = await fetch(`/api/geocode?query=${encodeURIComponent(regionName)}`);
        const data = await res.json();
        if (data.error) { alert(`"${regionName}"ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`); return; }

        kakaoMap.setCenter(new kakao.maps.LatLng(data.lat, data.lng));
        kakaoMap.setLevel(7);
        // ì§€ë„ ì´ë™ í›„ ìë™ìœ¼ë¡œ dragend ì´ë²¤íŠ¸ ë°œìƒ ì•ˆ í•˜ë¯€ë¡œ ì§ì ‘ í˜¸ì¶œ
        loadStores();
      } catch (err) {
        alert('ì§€ì—­ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // =====================================================
    // ì‹œì‘
    // =====================================================
    window.onload = () => {
      if (typeof kakao !== 'undefined' && kakao.maps) {
        initMap();
      } else {
        document.getElementById('map').innerHTML =
          '<div style="padding:60px;text-align:center;color:#7a7668">ì¹´ì¹´ì˜¤ ì§€ë„ API í‚¤ë¥¼ HTML ìƒë‹¨ì— ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
      }
    };
  </script>
</body>

</html>